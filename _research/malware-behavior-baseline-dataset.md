---
layout: default
title: "Containerized Malware Baselines: Defining Behavioral Ground Truth"
description: "A pipeline to build reliable behavioral datasets of malware in rootless containers, collecting metrics for ground truth analysis."
permalink: /research/malware-behavior-baseline-dataset/
---

# Containerized Malware Baselines
## Defining Behavioral Ground Truth with Rootless Podman on Arch Linux

---

> **PROJECT STATUS:** `ACTIVE` ðŸŸ¢
> **HOST:** Arch Linux Â· **ENGINE:** Podman (Rootless)
> **FOCUS:** Malware Baselines Â· Behavioral Analysis Â· Ground Truth
> ![Arch](https://img.shields.io/badge/Arch_Linux-Distro-1793d1?style=flat-square&logo=arch-linux&logoColor=white) ![Podman](https://img.shields.io/badge/Podman-Rootless-892ca0?style=flat-square&logo=podman&logoColor=white)

### âš¡ TL;DR

This document designs and validates a reference laboratory for establishing behavioral baselines of known malware. It leverages **rootless containers** and **isolated networks** on Arch Linux. The lab specifically avoids dangerous malware, opting instead for permissible public datasets and controlled behavioral analysis.

**Key Goals:**
*   Establish a "ground truth" for malware behavior.
*   Utilize rootless Podman containers for secure, isolated execution.
*   Collect comprehensive behavioral telemetry (DNS, HTTP/S, processes, resources, IOCs).
*   Provide a reproducible framework for comparative analysis and dataset generation.

---

## 1. Why We Need Malware Behavioral Ground Truth

The industry constantly chants "detect more threats," yet rarely defines an operational ground truth for behavior. An analyst needs to discern when a binary is acting "normal for malware" versus "strangely dangerous for malware."

In science, ground truth refers to verified data serving as a real-world reference for future comparisons. In malware research, this translates to having a manual of expected behaviors for known threats before analyzing unknown ones.

---

## 2. The Method: Rootless Containers + Multiple Isolated Networks

Podman enables running containers without a root daemon on the host. Arch Linux serves as our host's base system due to its:

*   Auditability
*   Flexibility
*   Minimalism
*   And its appeal to system enthusiasts who enjoy wrestling with firewalls.

### ðŸ§ª Lab Components:

*   **Rootless Containers:** Isolated user namespaces.
*   **Multiple Internal Networks:** `netLAB`, `netDNS`, `netLAN`, `netWAN`.
*   **Fake C2 Listeners:** To capture network beacons without real internet egress.
*   **Telemetry Collection:** Logs and resource metrics per sample.
*   **IOC Hashing:** For record-keeping without distributing live samples.
*   **Environment Benchmarks:** To measure analysis overhead.

---

## 3. Building the Laboratory from Scratch

### 3.1 Base Tooling Installation on the Host

```bash
sudo pacman -Syu
sudo pacman -S podman crun slirp4netns netavark tcpdump yara jq
```

**Rootless Validation:**

```bash
podman info | grep -i rootless
# Should display: rootless: true
```

### 3.2 Create Isolated Internal Networks

```bash
podman network create netLAB --internal --subnet 10.200.0.0/24
podman network create netLAN --subnet 10.201.0.0/24
podman network create netWAN --subnet 10.202.0.0/24
podman network create netDNS --subnet 10.203.0.0/24
```
> ðŸ’¡ **Purpose:** These four segments provide no external egress, allowing us to simulate:
> *   A corporate LAN (`netLAN`)
> *   A fake internet for C2 (`netLAB`)
> *   A perimeter network (`netWAN`)
> *   A controlled DNS server (`netDNS`)

### 3.3 Prepare Fake C2 Listener on `netLAB`

```bash
podman run -d --rm --network netLAB --name fake-c2 alpine nc -lk -p 80
```
This container will act as the "fake command and control center" to collect HTTP beacons.

---

## 4. Safely Obtaining Known Malware

We will utilize the public MalwareBazaar dataset, which permits the legal download of samples for research purposes.

**Download a known benign reference sample:**

```bash
mkdir -p ~/malware-baselines
cd ~/malware-baselines
curl -L "https://mb-api.abuse.ch/api/v1/" -d "query=get_file&sha256_hash=EXAMPLE_HASH" -o sample.bin
sha256sum sample.bin > sample.hash
```
*(Replace `EXAMPLE_HASH` with an allowed public dataset hash)*

---

## 5. Collecting Static & Dynamic Behavior in Containers

### 5.1 Static Analysis (Non-Executional)

```bash
podman run --rm -it --read-only \
  -v ~/malware-baselines:/samples:ro \
  remnux/remnux-distro:focal bash -c "
cd /samples
file sample.bin
strings sample.bin | head -n 50
yara sample.bin || true
"
```
This command will return:
*   The actual file type.
*   Useful strings.
*   YARA match status.
*   Indication of packers.
*   Deterministic export.

### 5.2 Controlled Dynamic Analysis (Simulating Fake Internet)

```bash
sudo tcpdump -i any host 10.200.0.10 -w ~/malware-baselines/capture.pcap & \
TCP_PID=$!

podman run --rm -it \
  --network netLAB \
  -v ~/malware-baselines:/samples:ro \
  alpine sh -c "
cd /data
sleep 2
./samples/sample.bin || true
"

kill $TCP_PID
```
> ðŸ’¡ **Execution Flow:** This executes the sample within a fake NAT environment, capturing all traffic destined for the simulated C2 server.

---

## 6. Saving Logs and Metrics

**Streaming `stdout`/`stderr`:**

```bash
podman logs fake-c2 > ~/malware-baselines/fakec2.log
```

**Resource Statistics:**

```bash
podman stats --no-stream fake-c2 > ~/malware-baselines/stats.txt
```

**Quick Interpretation with JSON Parse:**

```bash
jq '.' ~/malware-baselines/sample-report.json
```

**Generated Artifacts:**
All files are systematically stored in `~/malware-baselines/`:
```text
~/malware-baselines/
  â”œâ”€â”€ sample.hash
  â”œâ”€â”€ fakec2.log
  â”œâ”€â”€ stats.txt
  â”œâ”€â”€ capture.pcap
  â””â”€â”€ sample-report.json
```

---

## 7. Environment Benchmarks

We measure the minimal real overhead by comparing host vs. container performance for a 1GB hashing/string analysis task:

```bash
truncate -s 1G testfile.bin
time sha256sum testfile.bin

time podman run --rm alpine sha256sum /test/testfile.bin
```
> ðŸ’¡ **Observation:** An ideal orientative lab would show a maximum overhead of +5â€“10% in rootless containers, aligning with similar HPC Container Overhead benchmarks.

Record your results in `/benchmarks/results.md`.

---

## 8. Conclusion

Utilizing Podman rootless containers and multiple isolated networks on Arch Linux enables the construction of a reproducible behavioral ground truth for known malware analysis.

### This lab offers:

*   No heavy VM overhead.
*   Rapid destruction and reconstruction.
*   Auditable and comparative analysis.
*   Enhanced security, even if an internal root escape occurs, as there is no root on the host.

---

## 9. Future Trajectory

Studies that could extend this research:

*   Integration with offensive/defensive CI/CD pipelines.
*   Automated IoC generation, diff-summaries, and categorization based on LLM prompts.
*   Incorporation of LLM-driven analysis as an additional layer of prioritization.

---

## 10. Useful References

*   **Host:** Arch Linux (rolling distro)
*   **Rootless Containers:** Podman
*   **Secure Dataset:** MalwareBazaar
*   **Static/Dynamic Analysis:** YARA, `tcpdump`, `jq`, `strings`